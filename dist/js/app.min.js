function addClassTo(a,b){var c=b.className.split(/\s+/);return-1===c.indexOf(a)&&c.push(a),b.className=c.join(" "),b}function removeClassFrom(a,b){var c=b.className.split(/\s+/),d=c.indexOf(a);return-1!==d&&c.splice(d,1),b.className=c.join(" "),b}function isArray(a){return"[object Array]"===Object.prototype.toString.call(a)}function isInt(a){return"number"==typeof a&&a%1==0}function div(){return document.createElement("div")}function contains(a){if(arguments.length<2)throw new Error("Nothing to search for!");var b=Array.prototype.slice.call(arguments).slice(1);return b.every(function(b){return-1!==a.indexOf(b)})}function Spritesheet(a){var b,c,d,e="stage__sprite_style_flipped",f=["x","y","width","height","length","delays","offsetX","offsetY"],g={},h=!1;return this.x=0,this.y=0,this.element=div(),this.element.style.backgroundImage="url('dist/i/sprites/"+a+".png')",this.element.setAttribute("class","stage__sprite"),this.isFlipped=function(){return h},this.flip=function(){return h=!h,h?addClassTo(e,this.element):removeClassFrom(e,this.element),this},this.animation=function(a,e){if(!arguments.length)return void 0!==b?b.name:null;if("string"!=typeof a||!a)throw new Error("Animation without name!");if(1===arguments.length){if(c=d=0,b=g[a],!b)throw new Error('No animation with name "'+a+'"');return this.x=this.x+b.offsetX,this.y=this.y+b.offsetY,this.element.style.width=b.width.toString()+"px"||"auto",this.element.style.height=b.height.toString()+"px"||"auto",this.element.style.backgroundPosition=-b.x.toString()+"px "+-b.y.toString()+"px",this}var h=e;for(var i in h)if(!contains(f,i))throw new Error("Key not allowed!");h.name=a;var j=["x","y","offsetX","offsetY"];if(j.forEach(function(a){h[a]=h[a]||0}),!h.width)throw new Error("Animation without width!");for(h.height=h.height||width,h.length=h.length||1,h.delays=h.delays||[];h.delays.length<h.length;)h.delays.push(0);if(new Array(h.x,h.y,h.width,h.height,h.length,h.offsetX,h.offsetY).every(isInt)===!1)throw new Error("Animation dimensions should be integers!");if(!isArray(h.delays)||isArray(h.delays)&&!h.delays.every(isInt))throw new Error("Animation delays should be an array of integers!");return h.delays.length>h.length&&(h.delays=h.delays.slice(0,h.length-1)),g[a]=e,this.animation(a)},this.next=function(){if(d++,d<b.delays[c])return this;d=0,c++,c>=b.length&&(c=0);var a=b.x+c*b.width;this.element.style.backgroundPosition=-a.toString()+"px "+-b.y.toString()+"px"},this}!function(){function a(a){return 87===a||38===a?"up":68===a||39===a?"right":83===a||40===a?"down":65===a||37===a?"left":void 0}function b(b){var c=a(b.keyCode);-1===l.indexOf(c)&&l.push(c)}function c(b){var c=l.indexOf(a(b.keyCode));-1!==c&&l.splice(c,1)}function d(a){a=a||["base"];var b=[];if(!isArray(a))throw new Error("Not an array");return a.forEach(function(a){var c=div();"string"!=typeof a&&(a=a.toString()),c.style.backgroundImage="url('dist/i/tiles/"+a+".png')",c.setAttribute("class","background__tile"),b.push(c),o.appendChild(c)}),b}function e(){p.forEach(function(a){var b=2*Math.floor(j);a.style.backgroundPosition=b.toString()+"px 0px"})}function f(){var a=l[0];switch(a){case"right":k-=i,g.isFlipped()&&g.flip();break;case"left":k+=i,g.isFlipped()||g.flip();break;default:k*=.8,Math.abs(k)<.1&&(k=0)}k=Math.min(VELOCITY_MAX,Math.abs(k))*(Math.abs(k)/k),k=k||0,j+=k,Math.abs(k)<1&&"walk"===g.animation()&&g.animation("idle"),Math.abs(k)>=1&&"idle"===g.animation()&&g.animation("walk"),g.next(),e()}var g=new Spritesheet("hero").animation("walk",{x:74,width:74,height:144,length:16}).animation("idle",{width:74,height:144}),h=80,i=.4;VELOCITY_MAX=3;var j=0,k=0,l=[],m=div(),n=div(),o=div();document.body.appendChild(m),m.setAttribute("id","screen"),m.setAttribute("tabindex",0),m.appendChild(n),m.appendChild(o),m.addEventListener("keydown",b),m.addEventListener("keyup",c),n.setAttribute("class","stage"),o.setAttribute("class","background"),n.appendChild(g.element);var p=d();setInterval(f,h)}();