function addClassTo(a,b){var c=b.className.split(/\s+/);return-1===c.indexOf(a)&&c.push(a),b.className=c.join(" "),b}function removeClassFrom(a,b){var c=b.className.split(/\s+/),d=c.indexOf(a);return-1!==d&&c.splice(d,1),b.className=c.join(" "),b}function isArray(a){return"[object Array]"===Object.prototype.toString.call(a)}function isNumber(a){return!isNaN(parseFloat(a))&&isFinite(a)}function isInt(a){return"number"==typeof a&&a%1==0}function isValidString(a){return"string"==typeof a&&""!==a}function div(){return document.createElement("div")}function contains(a){if(arguments.length<2)throw new Error("Nothing to search for!");var b=Array.prototype.slice.call(arguments).slice(1);return b.every(function(b){return-1!==a.indexOf(b)})}function SpriteSheet(a){if(!isValidString(a))throw new Error("SpriteSheet without a name!");var b,c,d,e,f="stage__sprite_style_flipped",g=["x","y","width","height","length","delays","offsetX","offsetY"],h={},i=!1,j=0,k=0,l=div();l.style.backgroundImage="url('dist/i/sprites/"+a+".png')",l.setAttribute("class","stage__sprite"),this.getName=function(){return a},this.getElement=function(){return l},this.isFlipped=function(){return i},this.position=function(a,b){if(!arguments.length)return{x:j,y:k};if(a=a||j,b=b||k,!isNumber(a)||!isNumber(b))throw new Error("Invalid coordinates!");a!==j&&(j=a,a*=2,l.style.left=Math.floor(a).toString()+"px"),b!==k&&(k=b,b*=2,l.style.top=Math.floor(b).toString()+"px")};return this.flip=function(){return i=!i,i?addClassTo(f,l):removeClassFrom(f,l),this},this.dimensions=function(a){if(a=a||b.name,!isValidString(a))throw new Error("Animation with invalid name!");if(e&&e.name===a)return e;e={};var c=h[a];for(var d in c)c.hasOwnProperty(d)&&(e[d]=c[d]);return e},this.animation=function(a,e){if(!arguments.length)return void 0!==b?b.name:null;if(!isValidString(a))throw new Error("Animation with invalid name!");if(1===arguments.length){if(c=d=0,b=h[a],!b)throw new Error('No animation with a name of "'+a+'"');var f=2*b.width,i=2*b.height,j=2*(b.x+b.offsetX),k=2*(b.y+b.offsetY);return l.style.width=f.toString()+"px"||"auto",l.style.height=i.toString()+"px"||"auto",l.style.backgroundPosition=-j.toString()+"px "+-k.toString()+"px",this}var m=e;for(var n in m)if(!contains(g,n))throw new Error('Key "'+n+'" is not allowed!');m.name=a;var o=["x","y","offsetX","offsetY"];if(o.forEach(function(a){m[a]=m[a]||0}),!m.width)throw new Error("Animation without a width!");for(m.height=m.height||f,m.length=m.length||1,m.delays=m.delays||[];m.delays.length<m.length;)m.delays.push(0);if(new Array(m.x,m.y,m.width,m.height,m.length,m.offsetX,m.offsetY).every(isInt)===!1)throw new Error("Animation dimensions should be integers!");if(!isArray(m.delays)||isArray(m.delays)&&!m.delays.every(isInt))throw new Error("Animation delays should be an array of integers!");return m.delays.length>m.length&&(m.delays=m.delays.slice(0,m.length-1)),h[a]=e,this.animation(a)},this.next=function(){if(d++,d<b.delays[c])return d+1>=b.delays[c]&&c+1>=b.length;d=0,c++,c>=b.length&&(c=0);var a=2*(b.x+c*b.width);return l.style.backgroundPosition=-a.toString()+"px "+-b.y.toString()+"px",last},!1}function GameObject(a,b,c,d){function e(e,g){if(e=e||1,g=g||b,!isNumber(g))throw new Error('Push with invalid value of "'+g.toString()+'"!');g*=e,j+=g,j=Math.min(c,Math.abs(j))*(Math.abs(j)/(j||1)),d+=j,(0>e&&a.isFlipped()||e>0&&!a.isFlipped())&&a.flip(),f()}function f(){Math.abs(j)<1&&"walk"===a.animation()&&a.animation("idle"),Math.abs(j)>=1&&"idle"===a.animation()&&a.animation("walk")}if(a instanceof SpriteSheet==!1)throw new Error("Please provide a sprite!");var g=.6,h=.4,i=3;if(b=b||h,c=c||i,d=d||0,!isNumber(d))throw new Error("GameObject with invalid starting scroll!");if(0>d)throw new Error("GameObject scroll cannot be lower than 0!");if(!isNumber(b)||!isNumber(c))throw new Error("GameObject with invalid velocity data!");var j=0;this.getSprite=function(){return a},this.getScroll=function(){return d},this.getVelocity=function(){return j},this.pushLeft=e.curry(),this.pushRight=e.curry(-1),this.wait=function(){j*=g,Math.abs(j)<.1&&(j=0),d+=j,f()}}function Room(a,b,c,d){var e="base",f=320;if(!isValidString(a))throw new Error("Room without a name!");if(b=b||e,c=c||f,d=d||1,!isValidString(b))throw new Error('Room with invalid type of "'+b+'"!');if(!isInt(c))throw new Error('Room with invalid width of "'+c+'"!');if(!isInt(d))throw new Error('Room with invalid depth of "'+d+'"!');c=Math.min(f,c);var g=[];this.getName=function(){return a},this.getWidth=function(){return c},this.getTiles=function(){if(g.length>0)return g;for(var a=0;d>a;++a){{var c=div();1===d?b:b+"_"+a.toString()}c.style.backgroundImage="url('dist/i/tiles/"+b+".png')",c.setAttribute("class","background__tile"),g.push(c)}return g}}Function.prototype.curry=function(){var a=Array.prototype.slice,b=a.apply(arguments),c=this;return function(){return c.apply(null,b.concat(a.apply(arguments)))}},function(){function a(a){return 87===a||38===a?"up":68===a||39===a?"right":83===a||40===a?"down":65===a||37===a?"left":void 0}function b(b){var c=a(b.keyCode);-1===n.indexOf(c)&&n.push(c)}function c(b){var c=n.indexOf(a(b.keyCode));-1!==c&&n.splice(c,1)}function d(){p.appendChild(s.getSprite().getElement())}function e(){r.getTiles().forEach(function(a){q.appendChild(a)})}function f(){if(r.getWidth()>j){var a=r.getTiles();a.forEach(function(b,c){var d=2*Math.floor(s.getScroll()/(a.length-c));b.style.backgroundPosition=d.toString()+"px 0px"})}}function g(){var a=n[0],b=s.getSprite(),c=(s.getScroll(),b.position()),d=b.dimensions();switch(a){case"right":s.pushRight();break;case"left":s.pushLeft();break;default:s.wait()}c.y=k-d.height-l,r.getWidth()===j?c.x-=s.getVelocity():c.x=j/2-d.width/2,b.position(c.x,c.y),b.next(),f()}function h(a,b){if(a instanceof Room==!1)throw new Error("Please provide a room!");var c=b;if(!isArray(c)||isArray(c)&&0===c.length&&!c.every(function(a){return a instanceof GameObject}))throw new Error("Please provide a correct array of objects!");r=a,s=b[0],d(),e()}var i=80,j=320,k=112,l=6,m={};m.hero=new SpriteSheet("hero").animation("walk",{x:37,width:37,height:72,length:16}).animation("idle",{width:37,height:72});var n=[],o=div(),p=div(),q=div();document.body.appendChild(o),o.setAttribute("id","screen"),o.setAttribute("tabindex",0),o.appendChild(p),o.appendChild(q),o.addEventListener("keydown",b),o.addEventListener("keyup",c),p.setAttribute("class","stage"),q.setAttribute("class","background");var r,s;h(new Room("blank",null,640),[new GameObject(m.hero)]),setInterval(g,i)}();