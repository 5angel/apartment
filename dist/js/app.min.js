function addClassTo(a,b){var c=b.className.split(/\s+/);return-1===c.indexOf(a)&&c.push(a),b.className=c.join(" "),b}function removeClassFrom(a,b){var c=b.className.split(/\s+/),d=c.indexOf(a);return-1!==d&&c.splice(d,1),b.className=c.join(" "),b}function isArray(a){return"[object Array]"===Object.prototype.toString.call(a)}function isNumber(a){return!isNaN(parseFloat(a))&&isFinite(a)}function isInt(a){return"number"==typeof a&&a%1==0}function isValidString(a){return"string"==typeof a&&""!==a}function div(){return document.createElement("div")}function contains(a){if(arguments.length<2)throw new Error("Nothing to search for!");var b=Array.prototype.slice.call(arguments).slice(1);return b.every(function(b){return-1!==a.indexOf(b)})}var SpriteSheet=function(){function a(d,e){if(!isValidString(d))throw new Error("SpriteSheet without a name!");e=e||{};var f,g,h=!1,i=e.default,j=0,k=0;index=0;var l,m=div();m.style.backgroundImage="url('dist/i/sprites/"+d+".png')",m.setAttribute("class","stage__sprite"),this.getName=function(){return d},this.getElement=function(){return m},this.isFlipped=function(){return h},this.position=function(a,b){if(!arguments.length)return{x:j,y:k};if(a=0===a?0:a||j,b=0===b?0:b||k,!isNumber(a)||!isNumber(b))throw new Error("Invalid coordinates!");a!==j&&(j=a,a*=2,m.style.left=Math.floor(a).toString()+"px"),b!==k&&(k=b,b*=2,m.style.top=Math.floor(b).toString()+"px")},this.index=function(a){return arguments.length?void(index=a):index},this.flip=function(){return h=!h,h?addClassTo(b,m):removeClassFrom(b,m),this},this.dimensions=function(a){if(a=a||i.name,!isValidString(a))throw new Error("Animation with invalid name!");if(l&&l.name===a)return l;l={};var b=e[a];for(var c in b)b.hasOwnProperty(c)&&(l[c]=b[c]);return l},this.animation=function(a,b){if(!arguments.length)return void 0!==i?i.name:null;if(!isValidString(a))throw new Error("Animation with invalid name!");if(1===arguments.length){if(f=0,g=0,i=e[a],!i)throw new Error('No animation with a name of "'+a+'"');var d=2*i.width,h=2*i.height,j=2*(i.x+i.offsetX),k=2*(i.y+i.offsetY);return m.style.width=d.toString()+"px"||"auto",m.style.height=h.toString()+"px"||"auto",m.style.backgroundPosition=-j.toString()+"px "+-k.toString()+"px",m.style.zIndex=index,this}var l=b;for(var n in l)if(!contains(c,n))throw new Error('Key "'+n+'" is not allowed!');l.name=a;var o=["x","y","offsetX","offsetY"];if(o.forEach(function(a){l[a]=l[a]||0}),!l.width)throw new Error("Animation without a width!");for(l.height=l.height||d,l.length=l.length||1,l.delays=l.delays||[];l.delays.length<l.length;)l.delays.push(0);if(new Array(l.x,l.y,l.width,l.height,l.length,l.offsetX,l.offsetY).every(isInt)===!1)throw new Error("Animation dimensions should be integers!");if(!isArray(l.delays)||isArray(l.delays)&&!l.delays.every(isInt))throw new Error("Animation delays should be an array of integers!");return l.delays.length>l.length&&(l.delays=l.delays.slice(0,l.length-1)),e[a]=b,void 0===e.default&&(e.default=e[a]),this.animation(a)},this.next=function(){if(g++,g<i.delays[f])return g+1>=i.delays[f]&&f+1>=i.length;g=0,f++,f>=i.length&&(f=0);var a=2*(i.x+f*i.width);return m.style.backgroundPosition=-a.toString()+"px "+-i.y.toString()+"px",!1},this.clone=function(){return new a(d,e)},i&&this.animation("default")}var b="stage__sprite_style_flipped",c=["x","y","width","height","length","delays","offsetX","offsetY"];return a}(),GameObject=function(){function a(i,j,k,l,m){function n(a,b){if(a=a||1,b=b||j,!isNumber(b))throw new Error('Push with invalid value of "'+b.toString()+'"!');b*=a,q+=b,q=Math.min(k,Math.abs(q))*(Math.abs(q)/(q||1)),l-=q,(0>a&&i.isFlipped()||a>0&&!i.isFlipped())&&i.flip(),o(),p()}function o(){(0>l||l>m)&&(l=Math.min(m,Math.max(0,l)),q=0)}function p(){Math.abs(q)<1&&"walk"===i.animation()&&i.animation("idle"),Math.abs(q)>=1&&"idle"===i.animation()&&i.animation("walk")}if(i instanceof SpriteSheet==!1)throw new Error("Please provide a sprite!");if(j=j||f,k=k||g,l=l||0,m=m||h,!isNumber(l))throw new Error("GameObject with invalid starting scroll!");if(0>l)throw new Error("GameObject scroll cannot be lower than 0!");if(!isNumber(j)||!isNumber(k))throw new Error("GameObject with invalid velocity data!");if(!isInt(m))throw new Error("GameObject with invalid bound!");var q=0;this.getSprite=function(){return i},this.getScroll=function(){return l},this.getVelocity=function(){return q},this.setBound=function(a){if(!isInt(m))throw new Error("Bound should be integer!");m=a},this.pushLeft=n.bind(this,1),this.pushRight=n.bind(this,-1),this.wait=function(){q*=e,Math.abs(q)<.1&&(q=0),l-=q,p()},this.getDelta=function(){return b/2-i.dimensions().width/2},this.leftCornerReached=function(){return l<this.getDelta()},this.rightCornerReached=function(){return l+this.getDelta()>=m},this.correctPosition=function(e){if(null!==e&&!(e instanceof a))throw new Error("invalid relative object");var f=i.position(),g=i.dimensions(),h=g.width,j=g.height;f.y=c-j-d;var k=Math.floor(l-m+b-h)-1,n=Math.floor(l);if(e){var o=e.getScroll();f.x=e.leftCornerReached()||e.rightCornerReached()?e.rightCornerReached()?k:n:b/2-Math.ceil(i.dimensions().width/2)-Math.floor(o-l)}else f.x=this.leftCornerReached()||this.rightCornerReached()?this.rightCornerReached()?k:n:this.getDelta();i.position(f.x,f.y)}}var b=320,c=112,d=6,e=.6,f=.4,g=3,h=9007199254740992;return a}(),Room=function(){function a(a,d,e,f){if(!isValidString(a))throw new Error("Room without a name!");if(d=d||b,e=e||c,f=f||1,!isValidString(d))throw new Error('Room with invalid type of "'+d+'"!');if(!isInt(e))throw new Error('Room with invalid width of "'+e+'"!');if(!isInt(f))throw new Error('Room with invalid depth of "'+f+'"!');e=Math.max(c,e);var g=[];this.getName=function(){return a},this.getWidth=function(){return e},this.getTiles=function(){if(g.length>0)return g;for(var a=0;f>a;++a){{var b=div();1===f?d:d+"_"+a.toString()}b.style.backgroundImage="url('dist/i/tiles/"+d+".png')",b.setAttribute("class","background__tile"),g.push(b)}return g}}var b="base",c=320;return a}();!function(){function a(a){return 87===a||38===a?"up":68===a||39===a?"right":83===a||40===a?"down":65===a||37===a?"left":void 0}function b(b){var c=a(b.keyCode);-1===k.indexOf(c)&&k.push(c)}function c(b){var c=k.indexOf(a(b.keyCode));-1!==c&&k.splice(c,1)}function d(a,b,c){var a=q.getScroll(),c=Math.floor(q.getDelta()),b=o.getWidth(),d=Array.prototype.slice.call(m.childNodes,0);p.forEach(function(a){var b=a.getSprite(),c=b.getElement();a.correctPosition(a===q?null:q),b.next();var e=b.position(),f=b.dimensions(),i=e.x+f.width<0||e.x>=g||e.y+f.height<0||e.y>=h;i&&contains(d,c)?m.removeChild(c):i||contains(d,c)||m.appendChild(c)});var e=0;a+c>=b?e=b-2*c:a>=c&&(e=Math.floor(a)-c);var f=o.getTiles();f.forEach(function(a,b){var c=2*-Math.floor(e/(f.length-b));a.style.backgroundPosition=c.toString()+"px 0px"})}function e(){var a=k[0];switch(a){case"right":q.pushRight();break;case"left":q.pushLeft();break;default:q.wait()}d()}function f(a,b){if(a instanceof Room==!1)throw new Error("Please provide a room!");var c=b;if(!isArray(c)||isArray(c)&&0===c.length&&!c.every(function(a){return a instanceof GameObject}))throw new Error("Please provide a correct array of objects!");o=a,p=b,q=b[0],q.getSprite().index(1),p.forEach(function(b){b.setBound(a.getWidth())}),o.getTiles().forEach(function(a){n.appendChild(a)}),m.appendChild(q.getSprite().getElement())}var g=320,h=112,i=80,j={};j.hero=new SpriteSheet("hero").animation("idle",{width:37,height:72}).animation("walk",{x:37,width:37,height:72,length:16});var k=[],l=div(),m=div(),n=div();document.body.appendChild(l),l.setAttribute("id","screen"),l.setAttribute("tabindex",0),l.appendChild(m),l.appendChild(n),l.addEventListener("keydown",b),l.addEventListener("keyup",c),m.setAttribute("class","stage"),n.setAttribute("class","background");var o,p,q;f(new Room("blank",null,840),[new GameObject(j.hero,null,null,740),new GameObject(j.hero.clone(),null,null,40),new GameObject(j.hero.clone(),null,null,400),new GameObject(j.hero.clone(),null,null,780)]),setInterval(e,i)}();