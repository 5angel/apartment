function addClassTo(a,b){var c=b.className.split(/\s+/);return-1===c.indexOf(a)&&c.push(a),b.className=c.join(" "),b}function removeClassFrom(a,b){var c=b.className.split(/\s+/),d=c.indexOf(a);return-1!==d&&c.splice(d,1),b.className=c.join(" "),b}function isArray(a){return"[object Array]"===Object.prototype.toString.call(a)}function isNumber(a){return!isNaN(parseFloat(a))&&isFinite(a)}function isInt(a){return"number"==typeof a&&a%1==0}function isValidString(a){return"string"==typeof a&&""!==a}function div(){return document.createElement("div")}function contains(a){if(arguments.length<2)throw new Error("Nothing to search for!");var b=Array.prototype.slice.call(arguments).slice(1);return b.every(function(b){return-1!==a.indexOf(b)})}var SpriteSheet=function(){function a(a){if(!isValidString(a))throw new Error("SpriteSheet without a name!");var d,e,f,g,h={},i=!1,j=0,k=0,l=div();return l.style.backgroundImage="url('dist/i/sprites/"+a+".png')",l.setAttribute("class","stage__sprite"),this.getName=function(){return a},this.getElement=function(){return l},this.isFlipped=function(){return i},this.position=function(a,b){if(!arguments.length)return{x:j,y:k};if(a=0===a?0:a||j,b=0===b?0:b||k,!isNumber(a)||!isNumber(b))throw new Error("Invalid coordinates!");a!==j&&(j=a,a*=2,l.style.left=Math.floor(a).toString()+"px"),b!==k&&(k=b,b*=2,l.style.top=Math.floor(b).toString()+"px")},this.flip=function(){return i=!i,i?addClassTo(b,l):removeClassFrom(b,l),this},this.dimensions=function(a){if(a=a||d.name,!isValidString(a))throw new Error("Animation with invalid name!");if(g&&g.name===a)return g;g={};var b=h[a];for(var c in b)b.hasOwnProperty(c)&&(g[c]=b[c]);return g},this.animation=function(a,b){if(!arguments.length)return void 0!==d?d.name:null;if(!isValidString(a))throw new Error("Animation with invalid name!");if(1===arguments.length){if(e=f=0,d=h[a],!d)throw new Error('No animation with a name of "'+a+'"');var g=2*d.width,i=2*d.height,j=2*(d.x+d.offsetX),k=2*(d.y+d.offsetY);return l.style.width=g.toString()+"px"||"auto",l.style.height=i.toString()+"px"||"auto",l.style.backgroundPosition=-j.toString()+"px "+-k.toString()+"px",this}var m=b;for(var n in m)if(!contains(c,n))throw new Error('Key "'+n+'" is not allowed!');m.name=a;var o=["x","y","offsetX","offsetY"];if(o.forEach(function(a){m[a]=m[a]||0}),!m.width)throw new Error("Animation without a width!");for(m.height=m.height||g,m.length=m.length||1,m.delays=m.delays||[];m.delays.length<m.length;)m.delays.push(0);if(new Array(m.x,m.y,m.width,m.height,m.length,m.offsetX,m.offsetY).every(isInt)===!1)throw new Error("Animation dimensions should be integers!");if(!isArray(m.delays)||isArray(m.delays)&&!m.delays.every(isInt))throw new Error("Animation delays should be an array of integers!");return m.delays.length>m.length&&(m.delays=m.delays.slice(0,m.length-1)),h[a]=b,this.animation(a)},this.next=function(){if(f++,f<d.delays[e])return f+1>=d.delays[e]&&e+1>=d.length;f=0,e++,e>=d.length&&(e=0);var a=2*(d.x+e*d.width);return l.style.backgroundPosition=-a.toString()+"px "+-d.y.toString()+"px",!1},!1}var b="stage__sprite_style_flipped",c=["x","y","width","height","length","delays","offsetX","offsetY"];return a}(),GameObject=function(){function a(a,i,j,k,l){function m(b,c){if(b=b||1,c=c||i,!isNumber(c))throw new Error('Push with invalid value of "'+c.toString()+'"!');c*=b,p+=c,p=Math.min(j,Math.abs(p))*(Math.abs(p)/(p||1)),k-=p,(0>b&&a.isFlipped()||b>0&&!a.isFlipped())&&a.flip(),n(),o()}function n(){(0>k||k>l)&&(k=Math.min(l,Math.max(0,k)),p=0)}function o(){Math.abs(p)<1&&"walk"===a.animation()&&a.animation("idle"),Math.abs(p)>=1&&"idle"===a.animation()&&a.animation("walk")}if(a instanceof SpriteSheet==!1)throw new Error("Please provide a sprite!");if(i=i||f,j=j||g,k=k||0,l=l||h,!isNumber(k))throw new Error("GameObject with invalid starting scroll!");if(0>k)throw new Error("GameObject scroll cannot be lower than 0!");if(!isNumber(i)||!isNumber(j))throw new Error("GameObject with invalid velocity data!");if(!isInt(l))throw new Error("GameObject with invalid bound!");var p=0;this.getSprite=function(){return a},this.getScroll=function(){return k},this.getVelocity=function(){return p},this.setBound=function(a){if(!isInt(l))throw new Error("Bound should be integer!");l=a},this.pushLeft=m.bind(this,1),this.pushRight=m.bind(this,-1),this.wait=function(){p*=e,Math.abs(p)<.1&&(p=0),k-=p,o()},this.getDelta=function(){return b/2-a.dimensions().width/2},this.correctPosition=function(e){var f=a.position(),g=a.dimensions(),h=g.width,i=g.height;f.y=c-i-d;var j=this.getDelta(),l=j>k,m=k+j>=e;f.x=l||m?m?k-e+b-h:k:j,a.position(f.x,f.y),a.next()}}var b=320,c=112,d=6,e=.6,f=.4,g=3,h=9007199254740992;return a}(),Room=function(){function a(a,d,e,f){if(!isValidString(a))throw new Error("Room without a name!");if(d=d||b,e=e||c,f=f||1,!isValidString(d))throw new Error('Room with invalid type of "'+d+'"!');if(!isInt(e))throw new Error('Room with invalid width of "'+e+'"!');if(!isInt(f))throw new Error('Room with invalid depth of "'+f+'"!');e=Math.max(c,e);var g=[];this.getName=function(){return a},this.getWidth=function(){return e},this.getTiles=function(){if(g.length>0)return g;for(var a=0;f>a;++a){{var b=div();1===f?d:d+"_"+a.toString()}b.style.backgroundImage="url('dist/i/tiles/"+d+".png')",b.setAttribute("class","background__tile"),g.push(b)}return g}}var b="base",c=320;return a}();!function(){function a(a){return 87===a||38===a?"up":68===a||39===a?"right":83===a||40===a?"down":65===a||37===a?"left":void 0}function b(b){var c=a(b.keyCode);-1===k.indexOf(c)&&k.push(c)}function c(b){var c=k.indexOf(a(b.keyCode));-1!==c&&k.splice(c,1)}function d(){m.appendChild(p.getSprite().getElement())}function e(){o.getTiles().forEach(function(a){n.appendChild(a)})}function f(a,b,c){var d=o.getTiles(),e=0;a+c>=b?e=b-2*c:a>=c&&(e=a-c),d.forEach(function(a,b){var c=2*-Math.floor(e/(d.length-b));a.style.backgroundPosition=c.toString()+"px 0px"})}function g(){var a=k[0];switch(a){case"right":p.pushRight();break;case"left":p.pushLeft();break;default:p.wait()}var b=p.getScroll(),c=p.getDelta(),d=o.getWidth();f(b,d,c),p.correctPosition(d)}function h(a,b){if(a instanceof Room==!1)throw new Error("Please provide a room!");var c=b;if(!isArray(c)||isArray(c)&&0===c.length&&!c.every(function(a){return a instanceof GameObject}))throw new Error("Please provide a correct array of objects!");b.forEach(function(b){b.setBound(a.getWidth())}),o=a,p=b[0],d(),e()}var i=80,j={};j.hero=new SpriteSheet("hero").animation("walk",{x:37,width:37,height:72,length:16}).animation("idle",{width:37,height:72});var k=[],l=div(),m=div(),n=div();document.body.appendChild(l),l.setAttribute("id","screen"),l.setAttribute("tabindex",0),l.appendChild(m),l.appendChild(n),l.addEventListener("keydown",b),l.addEventListener("keyup",c),m.setAttribute("class","stage"),n.setAttribute("class","background");var o,p;h(new Room("blank",null,420),[new GameObject(j.hero)]),setInterval(g,i)}();