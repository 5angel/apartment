function addClassTo(a,b){var c=b.className.split(/\s+/);return-1===c.indexOf(a)&&c.push(a),b.className=c.join(" "),b}function removeClassFrom(a,b){var c=b.className.split(/\s+/),d=c.indexOf(a);return-1!==d&&c.splice(d,1),b.className=c.join(" "),b}function isArray(a){return"[object Array]"===Object.prototype.toString.call(a)}function isNumber(a){return!isNaN(parseFloat(a))&&isFinite(a)}function isInt(a){return"number"==typeof a&&a%1==0}function isValidString(a){return"string"==typeof a&&""!==a}function div(){return document.createElement("div")}function contains(a){if(arguments.length<2)throw new Error("Nothing to search for!");var b=Array.prototype.slice.call(arguments).slice(1);return b.every(function(b){return-1!==a.indexOf(b)})}function Sprite(a){if(!isValidString(a))throw new Error("Sprite without a name!");var b,c,d,e,f="stage__sprite_style_flipped",g=["x","y","width","height","length","delays","offsetX","offsetY"],h={},i=!1,j=0,k=0,l=0,m=div();m.style.backgroundImage="url('dist/i/sprites/"+a+".png')",m.setAttribute("class","stage__sprite"),this.getName=function(){return a},this.getElement=function(){return m},this.isFlipped=function(){return i},this.position=function(a,b){if(!arguments.length)return{x:j,y:k};if(a=a||j,b=b||k,!isNumber(a)||!isNumber(b))throw new Error("Invalid coordinates!");a!==j&&(j=a,a*=2,m.style.left=Math.floor(a).toString()+"px"),b!==k&&(k=b,b*=2,m.style.top=Math.floor(b).toString()+"px")},this.velocity=function(a){if(!arguments.length)return l;if(!isNumber(a))throw new Error('Velocity with invalid value of "'+a+'"!');l=a};return this.flip=function(){return i=!i,i?addClassTo(f,m):removeClassFrom(f,m),this},this.dimensions=function(a){if(a=a||b.name,!isValidString(a))throw new Error("Animation with invalid name!");if(e&&e.name===a)return e;e={};var c=h[a];for(var d in c)c.hasOwnProperty(d)&&(e[d]=c[d]);return e},this.animation=function(a,e){if(!arguments.length)return void 0!==b?b.name:null;if(!isValidString(a))throw new Error("Animation with invalid name!");if(1===arguments.length){if(c=d=0,b=h[a],!b)throw new Error('No animation with a name of "'+a+'"');var f=2*b.width,i=2*b.height,j=2*(b.x+b.offsetX),k=2*(b.y+b.offsetY);return m.style.width=f.toString()+"px"||"auto",m.style.height=i.toString()+"px"||"auto",m.style.backgroundPosition=-j.toString()+"px "+-k.toString()+"px",this}var l=e;for(var n in l)if(!contains(g,n))throw new Error('Key "'+n+'" is not allowed!');l.name=a;var o=["x","y","offsetX","offsetY"];if(o.forEach(function(a){l[a]=l[a]||0}),!l.width)throw new Error("Animation without a width!");for(l.height=l.height||f,l.length=l.length||1,l.delays=l.delays||[];l.delays.length<l.length;)l.delays.push(0);if(new Array(l.x,l.y,l.width,l.height,l.length,l.offsetX,l.offsetY).every(isInt)===!1)throw new Error("Animation dimensions should be integers!");if(!isArray(l.delays)||isArray(l.delays)&&!l.delays.every(isInt))throw new Error("Animation delays should be an array of integers!");return l.delays.length>l.length&&(l.delays=l.delays.slice(0,l.length-1)),h[a]=e,this.animation(a)},this.next=function(){if(d++,d<b.delays[c])return this;d=0,c++,c>=b.length&&(c=0);var a=2*(b.x+c*b.width);m.style.backgroundPosition=-a.toString()+"px "+-b.y.toString()+"px"},this}function Room(a,b,c,d){var e="base",f=320;if(!isValidString(a))throw new Error("Room without a name!");if(b=b||e,c=c||f,d=d||1,!isValidString(b))throw new Error('Room with invalid type of "'+b+'"!');if(!isInt(c))throw new Error('Room with invalid width of "'+c+'"!');if(!isInt(d))throw new Error('Room with invalid depth of "'+d+'"!');c=Math.min(f,c);var g=[];this.getName=function(){return a},this.getWidth=function(){return c},this.getTiles=function(){if(g.length>0)return g;for(var a=0;d>a;++a){{var c=div();1===d?b:b+"_"+a.toString()}c.style.backgroundImage="url('dist/i/tiles/"+b+".png')",c.setAttribute("class","background__tile"),g.push(c)}return g}}Function.prototype.curry=function(){var a=Array.prototype.slice.apply(arguments),b=this;return function(){return b.apply(null,a.concat(Array.prototype.slice.apply(arguments)))}},function(){function a(a){return 87===a||38===a?"up":68===a||39===a?"right":83===a||40===a?"down":65===a||37===a?"left":void 0}function b(b){var c=a(b.keyCode);-1===r.indexOf(c)&&r.push(c)}function c(b){var c=r.indexOf(a(b.keyCode));-1!==c&&r.splice(c,1)}function d(){t.appendChild(q.getElement())}function e(){v.getTiles().forEach(function(a){u.appendChild(a)})}function f(){if(v.getWidth()>m){var a=v.getTiles();a.forEach(function(b,c){var d=2*Math.floor(q.position()/(a.length-c));b.style.backgroundPosition=d.toString()+"px 0px"})}}function g(){var a=r[0],b=q.velocity(),c=q.position(),d=q.dimensions();switch(a){case"right":b-=k,q.isFlipped()&&q.flip();break;case"left":b+=k,q.isFlipped()||q.flip();break;default:b*=j,Math.abs(b)<.1&&(b=0)}b=Math.min(l,Math.abs(b))*(Math.abs(b)/b),b=b||0,Math.abs(b)<1&&"walk"===q.animation()&&q.animation("idle"),Math.abs(b)>=1&&"idle"===q.animation()&&q.animation("walk"),c.y=n-d.height-o,v.getWidth()===m?c.x-=b:c.x=m/2-d.width/2,q.position(c.x,c.y),q.velocity(b),q.next(),f()}function h(a){v=a,d(),e()}var i=80,j=.6,k=.4,l=3,m=320,n=112,o=6,p={};p.hero=new Sprite("hero").animation("walk",{x:37,width:37,height:72,length:16}).animation("idle",{width:37,height:72});var q=p.hero,r=[],s=div(),t=div(),u=div();document.body.appendChild(s),s.setAttribute("id","screen"),s.setAttribute("tabindex",0),s.appendChild(t),s.appendChild(u),s.addEventListener("keydown",b),s.addEventListener("keyup",c),t.setAttribute("class","stage"),u.setAttribute("class","background");var v;h(new Room("blank")),setInterval(g,i)}();