function isArray(a){return"[object Array]"===Object.prototype.toString.call(a)}function isNumber(a){return!isNaN(parseFloat(a))&&isFinite(a)}function isInt(a){return"number"==typeof a&&a%1==0}function isValidString(a){return"string"==typeof a&&""!==a}function contains(a){if(arguments.length<2)throw new Error("Nothing to search for!");var b=Array.prototype.slice.call(arguments).slice(1);return b.every(function(b){return-1!==a.indexOf(b)})}var RichHTMLElement=function(){function a(a){this.target=a}return a.prototype.getClasses=function(){return this.target.className.split(/\s+/)},a.prototype.hasClass=function(a){return-1!==this.getClasses().indexOf(a)},a.prototype.addClass=function(a){if(!this.hasClass(a)){var b=this.getClasses();b.push(a),this.target.className=b.join(" ")}},a.prototype.removeClass=function(a){if(this.hasClass(a)){var b=this.getClasses(),c=b.indexOf(a);b.splice(c,1),this.target.className=b.join(" ")}},a}(),SpriteSheet=function(){function a(a){for(var b in a){if(!contains(g,b))throw new Error('Key "'+b+'" is not allowed!');if(!isInt(a[b]))throw new Error('Key "'+b+'" should be an integer!')}if(h.forEach(function(b){a[b]=a[b]||0}),isNaN(a.width)||a.width<=0)throw new Error("Animation without a width!");for(a.height=a.height||a.width,a.length=a.length||1,a.delays=a.delays||[];a.delays.length<a.length;)a.delays.push(0);return a}function b(f,g){this.name=f,this.element=new RichHTMLElement(document.createElement("div")),this.index=0,this.frame=0,this.delay=0,this.flipped=!1,this.animation=g?g.default:null,this.element.target.style.backgroundImage=c+f+d,this.element.addClass(e),g=g||{},this.addAnimation=function(b,c){return c=a(c),g[b]=c,this.animation=b,g.default||(g.default=b),this.redraw(),this},this.getAnimation=function(a){return g[a||this.animation]},this.clone=function(){return new b(f,g)}}var c="url('dist/i/sprites/",d=".png')",e="stage__sprite",f=e+"_style_flipped",g=["x","y","offsetX","offsetY","width","height","length","delays"],h=g.slice(0,4);return b.prototype.getDimensions=function(){var a=this.getAnimation(),b={width:a.width,height:a.height};return b},b.prototype.next=function(){this.delay++;var a=this.getAnimation();if(this.delay<a.delays[this.frame])return this.delay+1>=a.delays[frame]&&this.frame+1>=a.length;this.delay=0,this.frame++,this.frame>=a.length&&(this.frame=0);var b=2*(a.x+this.frame*a.width),c=a.y;return this.element.target.style.backgroundPosition=-b.toString()+"px "+-c.toString()+"px",!1},b.prototype.update=function(){var a=this.element.target.style;a.left=Math.floor(2*this.x).toString()+"px",a.top=Math.floor(2*this.y).toString()+"px"},b.prototype.redraw=function(){var a=this.element.target.style,b=this.getAnimation(),c=2*b.width,d=2*b.height,e=2*(b.x+b.offsetX),f=2*(b.y+b.offsetY);a.width=c.toString()+"px"||"auto",a.height=d.toString()+"px"||"auto",a.zIndex=this.index,a.backgroundPosition=-e.toString()+"px "+-f.toString()+"px"},b.prototype.flip=function(){var a=this.element.hasClass(f);this.flipped&&a?this.element.removeClass(f):this.flipped||a||this.element.addClass(f),this.flipped=!this.flipped},b}(),GameObject=function(){function a(i,j,k,l,m){function n(a,b){if(a=a||1,b=b||j,!isNumber(b))throw new Error('Push with invalid value of "'+b.toString()+'"!');b*=a,p+=b,p=Math.min(k,Math.abs(p))*(Math.abs(p)/(p||1)),l-=p,(0>a&&i.flipped||a>0&&!i.flipped)&&i.flip(),(0>l||l>m)&&(l=Math.min(m,Math.max(0,l)),p=0),o()}function o(){Math.abs(p)<1&&"walk"===i.animation&&(i.animation="idle"),Math.abs(p)>=1&&"idle"===i.animation&&(i.animation="walk"),i.redraw()}if(i instanceof SpriteSheet==!1)throw new Error("Please provide a sprite!");if(j=j||f,k=k||g,l=l||0,m=m||h,!isNumber(l))throw new Error("GameObject with invalid starting scroll!");if(0>l)throw new Error("GameObject scroll cannot be lower than 0!");if(!isNumber(j)||!isNumber(k))throw new Error("GameObject with invalid velocity data!");if(!isInt(m))throw new Error("GameObject with invalid bound!");var p=0;this.getSprite=function(){return i},this.getScroll=function(){return l},this.getVelocity=function(){return p},this.setBound=function(a){if(!isInt(m))throw new Error("Bound should be integer!");m=a},this.pushLeft=n.bind(this,1),this.pushRight=n.bind(this,-1),this.wait=function(){p*=e,Math.abs(p)<.1&&(p=0),l-=p,o()},this.getDelta=function(){return b/2-i.getDimensions().width/2},this.leftCornerReached=function(){return l<this.getDelta()},this.rightCornerReached=function(){return l+this.getDelta()>=m},this.correctPosition=function(e){if(null!==e&&!(e instanceof a))throw new Error("invalid relative object");var f=i.x,g=i.y,h=i.getDimensions();g=c-h.height-d;var j=Math.floor(l-m+b-h.width)-1,k=Math.floor(l);if(e){var n=e.getScroll();f=e.leftCornerReached()||e.rightCornerReached()?e.rightCornerReached()?j:k:b/2-Math.ceil(h.width/2)-Math.floor(n-l)}else f=this.leftCornerReached()||this.rightCornerReached()?this.rightCornerReached()?j:k:this.getDelta();i.x=f,i.y=g,i.update()}}var b=320,c=112,d=6,e=.6,f=.4,g=3,h=9007199254740992;return a}(),Room=function(){function a(a,d,e,f){if(!isValidString(a))throw new Error("Room without a name!");if(d=d||b,e=e||c,f=f||1,!isValidString(d))throw new Error('Room with invalid type of "'+d+'"!');if(!isInt(e))throw new Error('Room with invalid width of "'+e+'"!');if(!isInt(f))throw new Error('Room with invalid depth of "'+f+'"!');e=Math.max(c,e);var g=[];this.getName=function(){return a},this.getWidth=function(){return e},this.getTiles=function(){if(g.length>0)return g;for(var a=0;f>a;++a){{var b=document.createElement("div");1===f?d:d+"_"+a.toString()}b.style.backgroundImage="url('dist/i/tiles/"+d+".png')",b.setAttribute("class","background__tile"),g.push(b)}return g}}var b="base",c=320;return a}();!function(){function a(a){return 87===a||38===a?"up":68===a||39===a?"right":83===a||40===a?"down":65===a||37===a?"left":void 0}function b(b){var c=a(b.keyCode);-1===k.indexOf(c)&&k.push(c)}function c(b){var c=k.indexOf(a(b.keyCode));-1!==c&&k.splice(c,1)}function d(a,b,c){var a=q.getScroll(),c=Math.floor(q.getDelta()),b=o.getWidth(),d=Array.prototype.slice.call(m.childNodes,0);p.forEach(function(a){var b=a.getSprite();a.correctPosition(a===q?null:q),b.next(),b.update();var c=b.getDimensions().width,e=b.getDimensions().height,f=b.x+c<0||b.x>=g||b.y+e<0||b.y>=h,i=b.element.target;f&&contains(d,i)?m.removeChild(i):f||contains(d,i)||m.appendChild(i)});var e=0;a+c>=b?e=b-2*c:a>=c&&(e=Math.floor(a)-c);var f=o.getTiles();f.forEach(function(a,b){var c=2*-Math.floor(e/(f.length-b));a.style.backgroundPosition=c.toString()+"px 0px"})}function e(){var a=k[0];switch(a){case"right":q.pushRight();break;case"left":q.pushLeft();break;default:q.wait()}d()}function f(a,b){if(a instanceof Room==!1)throw new Error("Please provide a room!");var c=b;if(!isArray(c)||isArray(c)&&0===c.length&&!c.every(function(a){return a instanceof GameObject}))throw new Error("Please provide a correct array of objects!");o=a,p=b,q=b[0],q.getSprite().index=1,p.forEach(function(b){b.setBound(a.getWidth()),b.getSprite().redraw()}),o.getTiles().forEach(function(a){n.appendChild(a)}),m.appendChild(q.getSprite().element.target)}var g=320,h=112,i=80,j={};j.hero=new SpriteSheet("hero").addAnimation("idle",{width:37,height:72}).addAnimation("walk",{x:37,width:37,height:72,length:16});var k=[],l=document.createElement("div"),m=document.createElement("div"),n=document.createElement("div");document.body.appendChild(l),l.setAttribute("id","screen"),l.setAttribute("tabindex",0),l.appendChild(m),l.appendChild(n),l.addEventListener("keydown",b),l.addEventListener("keyup",c),m.setAttribute("class","stage"),n.setAttribute("class","background");var o,p,q;f(new Room("blank",null,840),[new GameObject(j.hero,null,null,740),new GameObject(j.hero.clone(),null,null,40),new GameObject(j.hero.clone(),null,null,400),new GameObject(j.hero.clone(),null,null,780)]),setInterval(e,i)}();