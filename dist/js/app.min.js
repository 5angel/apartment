function addClassTo(a,b){var c=b.className.split(/\s+/);return-1===c.indexOf(a)&&c.push(a),b.className=c.join(" "),b}function removeClassFrom(a,b){var c=b.className.split(/\s+/),d=c.indexOf(a);return-1!==d&&c.splice(d,1),b.className=c.join(" "),b}function isArray(a){return"[object Array]"===Object.prototype.toString.call(a)}function isInt(a){return"number"==typeof a&&a%1==0}function isValidString(a){return"string"==typeof a&&""!==a}function div(){return document.createElement("div")}function contains(a){if(arguments.length<2)throw new Error("Nothing to search for!");var b=Array.prototype.slice.call(arguments).slice(1);return b.every(function(b){return-1!==a.indexOf(b)})}function Spritesheet(a){if(!isValidString(a))throw new Error("Spritesheet without a name!");var b,c,d,e="stage__sprite_style_flipped",f=["x","y","width","height","length","delays","offsetX","offsetY"],g={},h=!1,i=0,j=0,k=div();return k.style.backgroundImage="url('dist/i/sprites/"+a+".png')",k.setAttribute("class","stage__sprite"),this.getName=function(){return a},this.getElement=function(){return k},this.isFlipped=function(){return h},this.getPosition=function(){return{x:i,y:j}},this.flip=function(){return h=!h,h?addClassTo(e,k):removeClassFrom(e,k),this},this.animation=function(a,e){if(!arguments.length)return void 0!==b?b.name:null;if(!isValidString(a))throw new Error("Animation without a name!");if(1===arguments.length){if(c=d=0,b=g[a],!b)throw new Error('No animation with a name of "'+a+'"');return i+=b.offsetX,j+=b.offsetY,k.style.width=b.width.toString()+"px"||"auto",k.style.height=b.height.toString()+"px"||"auto",k.style.backgroundPosition=-b.x.toString()+"px "+-b.y.toString()+"px",this}var h=e;for(var l in h)if(!contains(f,l))throw new Error('Key "'+l+'" is not allowed!');h.name=a;var m=["x","y","offsetX","offsetY"];if(m.forEach(function(a){h[a]=h[a]||0}),!h.width)throw new Error("Animation without a width!");for(h.height=h.height||width,h.length=h.length||1,h.delays=h.delays||[];h.delays.length<h.length;)h.delays.push(0);if(new Array(h.x,h.y,h.width,h.height,h.length,h.offsetX,h.offsetY).every(isInt)===!1)throw new Error("Animation dimensions should be integers!");if(!isArray(h.delays)||isArray(h.delays)&&!h.delays.every(isInt))throw new Error("Animation delays should be an array of integers!");return h.delays.length>h.length&&(h.delays=h.delays.slice(0,h.length-1)),g[a]=e,this.animation(a)},this.next=function(){if(d++,d<b.delays[c])return this;d=0,c++,c>=b.length&&(c=0);var a=b.x+c*b.width;k.style.backgroundPosition=-a.toString()+"px "+-b.y.toString()+"px"},this}function Room(a,b,c){var d="base";if(!isValidString(a))throw new Error("Room without a name!");if(b=b||d,c=c||1,!isValidString(b))throw new Error('Room with invalid type of "'+b+'"!');if(!isInt(c))throw new Error('Room with invalid depth of "'+c+'"!');this.getName=function(){return a},this.getTiles=function(){for(var a=[],d=0;c>d;++d){{var e=div();1===c?b:b+"_"+d.toString()}e.style.backgroundImage="url('dist/i/tiles/"+b+".png')",e.setAttribute("class","background__tile"),a.push(e)}return a}}!function(){function a(a){return 87===a||38===a?"up":68===a||39===a?"right":83===a||40===a?"down":65===a||37===a?"left":void 0}function b(b){var c=a(b.keyCode);-1===l.indexOf(c)&&l.push(c)}function c(b){var c=l.indexOf(a(b.keyCode));-1!==c&&l.splice(c,1)}function d(a){p=a.getTiles(),p.forEach(function(a){o.appendChild(a)})}function e(){p.forEach(function(a){var b=2*Math.floor(j);a.style.backgroundPosition=b.toString()+"px 0px"})}function f(){var a=l[0];switch(a){case"right":k-=i,g.isFlipped()&&g.flip();break;case"left":k+=i,g.isFlipped()||g.flip();break;default:k*=.8,Math.abs(k)<.1&&(k=0)}k=Math.min(VELOCITY_MAX,Math.abs(k))*(Math.abs(k)/k),k=k||0,j+=k,Math.abs(k)<1&&"walk"===g.animation()&&g.animation("idle"),Math.abs(k)>=1&&"idle"===g.animation()&&g.animation("walk"),g.next(),e()}var g=new Spritesheet("hero").animation("walk",{x:74,width:74,height:144,length:16}).animation("idle",{width:74,height:144}),h=80,i=.4;VELOCITY_MAX=3;var j=0,k=0,l=[],m=div(),n=div(),o=div();document.body.appendChild(m),m.setAttribute("id","screen"),m.setAttribute("tabindex",0),m.appendChild(n),m.appendChild(o),m.addEventListener("keydown",b),m.addEventListener("keyup",c),n.setAttribute("class","stage"),n.appendChild(g.getElement()),o.setAttribute("class","background");var p;d(new Room("blank")),setInterval(f,h)}();